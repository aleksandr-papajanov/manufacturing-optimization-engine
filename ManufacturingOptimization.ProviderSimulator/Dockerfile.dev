FROM mcr.microsoft.com/dotnet/sdk:9.0
WORKDIR /app

# Restore dependencies (cached layer)
COPY ["ManufacturingOptimization.ProviderSimulator/ManufacturingOptimization.ProviderSimulator.csproj", "ManufacturingOptimization.ProviderSimulator/"]
COPY ["ManufacturingOptimization.Common.Models/ManufacturingOptimization.Common.Models.csproj", "ManufacturingOptimization.Common.Models/"]
COPY ["ManufacturingOptimization.Common.Messaging/ManufacturingOptimization.Common.Messaging.csproj", "ManufacturingOptimization.Common.Messaging/"]

RUN dotnet restore "ManufacturingOptimization.ProviderSimulator/ManufacturingOptimization.ProviderSimulator.csproj"

# Создаем чистый nuget.config без Windows путей
RUN dotnet nuget locals all --clear

# Source code will be mounted as volume at runtime
# So we don't COPY it here - allows hot reload

WORKDIR /app

# Use dotnet watch for hot reload - explicitly specify project path
ENTRYPOINT ["dotnet", "watch", "run", "--project", "ManufacturingOptimization.ProviderSimulator/ManufacturingOptimization.ProviderSimulator.csproj", "--no-restore", "--non-interactive"]
