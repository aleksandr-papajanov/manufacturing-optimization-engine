@startuml
!theme plain
autonumber

participant "Workflow Pipeline" as Pipeline
queue RabbitMQ as MQ
participant "Provider Simulator" as Provider
participant "API Gateway" as Gateway
database "Plan Repository" as PlanDB
participant UI
actor Customer

== Confirmation ==

loop For each process in selected strategy
  Pipeline -> MQ: RPC ConfirmProcessCommand\n(process.confirm.{providerId})
  MQ -> Provider: Confirmation request
  Provider -> Provider: Reserve capacity
  Provider -> MQ: ProcessConfirmedEvent
  MQ -> Pipeline: Deliver confirmation
end

== Plan Persistence ==

Pipeline -> Pipeline: Create OptimizationPlan
Pipeline -> MQ: Publish OptimizationPlanReadyEvent
MQ -> Gateway: Deliver event
Gateway -> PlanDB: Store plan

== Client Retrieves Plan ==

UI -> Gateway: GET /api/optimization/plan/{planId}
Gateway -> PlanDB: Read plan
Gateway -> UI: Return OptimizationPlan
UI -> Customer: Display final plan

@enduml